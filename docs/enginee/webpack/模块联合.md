---
id: webpackModuleFederation
title: Module federation
hide_title: true
sidebar_label: Module federation
---

### 基本概念

- `Host`：消费其他 `Remote` 的应用
- `Remote`：被 `Host` 消费的应用

### 配置项

```javascript
new ModuleFederationPlugin({
  name: "app-1",
  library: { type: "var", name: "app_1" },
  filename: "remoteEntry.js",
  remotes: {
    app_02: 'app_02',
    app_03: 'app_03',
  },
  exposes: {
    './antd': './src/antd',
    './button': './src/button',
  },
  shared: ['react', 'react-dom'],
})
```

- `name`，必须，唯一 ID，作为输出的模块名，使用的时通过 ${name}/${expose} 的方式使用；

- `library`，必须，其中这里的 name 为作为 umd 的 name；

- `remotes`，可选，表示作为 Host 时，去消费哪些 Remote；

- `exposes`，可选，表示作为 Remote 时，export 哪些属性被消费；

- `shared`，可选，优先用 Host 的依赖，如果 Host 没有，再用自己的（`对于remote来说`）；

### 注意事项

- `exposes`模块，需要带上`'./moduleName'`

  ```javascript
  // 错误
  new ModuleFederationPlugin({
    exposes: {
      antd: './src/antd',
      button: './src/button',
    }
  })

  // 正确
  new ModuleFederationPlugin({
    exposes: {
      './antd': './src/antd',d
      './button': './src/button',
    }
  })
  ```

- `Uncaught TypeError: fn is not a function`

这种情况很有可能是因为 `remote` 端提取了 `runtime`，然后 `remoteEntry.js` 在 `host` 端又最先执行，导致 `webpack` 内置方法没有提供[creating the runtime requirements in the ModuleFederationPlugin issue](https://github.com/webpack/webpack/pull/11843)。解决方案：

- 关闭 `runtime` 提取。
- 别人写的一个插件，在 `remote` 端使用。[moduleFedSingleRuntime.js](https://github.com/Guriqbal-Singh-Alida/basic-remote-runtime-single/blob/master/apps/app2/plugins/moduleFedSingleRuntime.js)。

```javascript
plugins: [
    new ModuleFedSingleRuntimePlugin(),
    new ModuleFederationPlugin({....
```
